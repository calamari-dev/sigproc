\NeedsTeXFormat{LaTeX2e}
\RequirePackage{expl3}
\ProvidesExplPackage{sigproc-base}{2023-02-28}{1.0}{sigproc-base}
\ExplSyntaxOff

\RequirePackage{xcolor}
\RequirePackage{amsthm,thmtools}
\RequirePackage{wrapfig}
\RequirePackage{tcolorbox}
\RequirePackage{cleveref}
\tcbuselibrary{breakable,skins,theorems}

% 参照
\crefname{appendix}{付録}{付録}
\crefname{chapter}{}{}
\crefname{equation}{式}{式}
\crefname{figure}{図}{図}
\crefname{problem}{演習問題}{演習問題}
\crefname{section}{}{}
\crefname{subsection}{}{}
\crefname{table}{表}{表}

\crefname{corollary}{系}{系}
\crefname{definition}{定義}{定義}
\crefname{example}{例}{例}
\crefname{lemma}{補題}{補題}
\crefname{proposition}{命題}{命題}
\crefname{theorem}{定理}{定理}

\creflabelformat{chapter}{第#2#1#3章}
\creflabelformat{section}{第#2#1#3節}
\creflabelformat{subsection}{第#2#1#3小節}

\newcommand{\creflastconjunction}{，および}
\newcommand{\crefmiddleconjunction}{，}
\newcommand{\crefpairconjunction}{，}
\newcommand{\crefrangeconjunction}{から}

% 約物・論理構造
\newcommand{\alert}[1]{{\gtfamily\bfseries #1}}
\newcommand{\impact}[1]{{\gtfamily\bfseries #1}}
\newcommand{\termdef}[1]{{\gtfamily\bfseries #1}}
\newcommand{\texttwoemdash}{\resizebox{2\zw}{\height}{—}}

% 定理環境
\newcounter{thcounter}
\numberwithin{thcounter}{section}

\tcbset{
  mytheorem/.style={
    skin=standard jigsaw,
    beforeafter skip balanced={0.5\baselineskip},
    theorem style=plain,
    description delimiters={\inhibitglue（}{）\hspace*{-0.5\zw}},
    terminator sign={\hspace*{\zw}},
    label type={#1},
    fonttitle=\gtfamily\bfseries,
    opacityback=0.0,
    opacitybacktitle=0.0,
    colframe=black,
    coltitle=black,
    arc=0pt,
    boxrule=0.4pt,
    top=0.5\zh,
    right=0.5\zw,
    bottom=0.5\zh,
    left=0.5\zw
  }
}

\declaretheoremstyle[
  headfont=\gtfamily\bfseries,
  headpunct={},
  notebraces={\inhibitglue（}{）\hspace{-0.5\zw}},
  notefont=\gtfamily\bfseries,
  postheadspace=\zw,
  qed=\diamondsuit
]{egstyle}

\declaretheoremstyle[
  bodyfont=\small,
  headfont=\gtfamily\bfseries\small,
  headpunct={},
  notebraces={\inhibitglue（}{）\hspace{-0.5\zw}},
  notefont=\gtfamily\bfseries\small,
  numbered=no,
  postheadspace=\zw
]{notestyle}

\NewTcbTheorem[use counter=thcounter,number freestyle={\noexpand\thesection.\noexpand\arabic{\tcbcounter}}]{corollary}{系}{mytheorem=corollary}{corollary}
\NewTcbTheorem[use counter=thcounter,number freestyle={\noexpand\thesection.\noexpand\arabic{\tcbcounter}}]{definition}{定義}{mytheorem=definition}{definition}
\NewTcbTheorem[use counter=thcounter,number freestyle={\noexpand\thesection.\noexpand\arabic{\tcbcounter}}]{lemma}{補題}{mytheorem=lemma}{lemma}
\NewTcbTheorem[use counter=thcounter,number freestyle={\noexpand\thesection.\noexpand\arabic{\tcbcounter}}]{proposition}{命題}{mytheorem=proposition}{proposition}
\NewTcbTheorem[use counter=thcounter,number freestyle={\noexpand\thesection.\noexpand\arabic{\tcbcounter}}]{theorem}{定理}{mytheorem=theorem}{theorem}

\declaretheorem[sibling=thcounter,style=egstyle,name=例]{example}
\declaretheorem[style=egstyle,name=問]{problem}
\declaretheorem[style=notestyle,name=ノート]{note}

\tcolorboxenvironment{note}{
  blanker,
  breakable,
  borderline west={0.45\zw}{0pt}{lightgray},
  top=0.2\zh,
  bottom=0.2\zh,
  left=0.9\zw
}
